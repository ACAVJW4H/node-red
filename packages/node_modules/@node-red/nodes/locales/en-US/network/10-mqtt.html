<!--
  Copyright JS Foundation and other contributors, http://js.foundation
  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at
  http://www.apache.org/licenses/LICENSE-2.0
  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/html" data-help-name="mqtt in">
<p>Connects to a MQTT broker and subscribes to messages from the specified topic.</p>
    <h3>Outputs</h3>
    <dl class="message-properties">
       <dt>payload <span class="property-type">string | buffer</span></dt>
       <dd>a string unless detected as a binary buffer.</dd>
       <dt>topic <span class="property-type">string</span></dt>
       <dd>the MQTT topic, uses / as a hierarchy separator.</dd>
       <dt>qos <span class="property-type">number</span> </dt>
       <dd>0, fire and forget - 1, at least once - 2, once and once only.</dd>
       <dt>retain <span class="property-type">boolean</span></dt>
       <dd>true indicates the message was retained and may be old.</dd>

       <dt class="optional">responseTopic <span class="property-type">string</span></dt>
       <dd><b>MQTTv5</b>: the MQTT response topic for the message</dd>
       <dt class="optional">correlationData <span class="property-type">Buffer</span></dt>
       <dd><b>MQTTv5</b>: the correlation data for the message</dd>
       <dt class="optional">contentType <span class="property-type">string</span></dt>
       <dd><b>MQTTv5</b>: the content-type of the payload</dd>
       <dt class="optional">userProperties <span class="property-type">object</span></dt>
       <dd><b>MQTTv5</b>: any user properties of the message</dd>
       <dt class="optional">messageExpiryInterval <span class="property-type">number</span></dt>
       <dd><b>MQTTv5</b>: the expiry time, in seconds, of the message</dd>
    </dl>
    <h3>Details</h3>
    The subscription topic can include MQTT wildcards, + for one level, # for multiple levels.</p>
    <p>This node requires a connection to a MQTT broker to be configured. This is configured by clicking
    the pencil icon.</p>
    <p>Several MQTT nodes (in or out) can share the same broker connection if required.</p>
</script>

<script type="text/html" data-help-name="mqtt control">
   <p>Advanced MQTT Control to connect, disconnect, subscribe, unsubscribe and publish to the selected MQTT broker.</p>
   <h3>Inputs</h3>
   <dl class="message-properties">
      <dt>action <span class="property-type">string</span></dt>
      <dd>
         The action property specifies which operation to perform. <br>
         <code>msg.action</code> must be either "connect", "disconnect", "subscribe", "unsubscribe" or "list".
      </dd>

      <hr style="margin: 8px">

      <h4 style="font-size: medium;font-style: italic;">"connect" action message properties...</h4>
      <dt class="optional">options <span class="property-type">object</span></dt>
      <dd>
         The <code>msg.options</code> object is an optional msg parameter that permits you to override settings on the broker before connecting.<br>
         * All properties of <code>msg.options</code> are optional.<br>
         * Exclude properties you do not want to change.<br>
         * To clear/default the value of a property, set it to null.
         * This property is only valid when action is "connect"
         <h5>example...</h5>
         <pre style="font-size: smaller;white-space: pre;">msg.options = {
   url: "tcp://xxxxxxx", //Alternatively, set broker and port
   broker: "192.168.0.x",
   port: "1883",
   clientid: null,//string client ID
   usetls: false,
   usews: false,
   verifyservercert: false,
   protocolVersion: 5, //3, 4 or 5
   keepalive: 0, //seconds, set to 0 to disable
   cleansession: true,
   sessionExpiry: "", //representing the Session Expiry Interval in seconds number
   userProperties: {}, //object containing key/string values
   "birth": {}, //see "will" for available properties
   "close": {}, //see "will" for available properties
   "will": {
      "payload": "", 
      "topic":"",
      "qos": 2, //(optional) 0: fire and forget, 1: at least once, 2: once and once only
      "retain": false, //(optional) 
      "contentType": "", //(optional) describing the content of the Message
      "responseTopic": "", //(optional) the Topic Name for a response message
      "correlationData": "", //(optional) Correlation Data
      "messageExpiryInterval": "", //(optional) lifetime of the Message in seconds
      "willDelayInterval": 0 //(optional) Will Delay Interval in seconds 
   }
}</pre> 
      </dd>

      <hr style="margin: 8px">

      <h4 style="font-size: medium;font-style: italic;">"disconnect" action message properties...</h4>
      <dd>The "disconnect" action requires no additional properties</dd>

      <hr style="margin: 8px">

      <h4 style="font-size: medium;font-style: italic;">"subscribe" action message properties...</h4>
      <dt>subscription <span class="property-type">string | object | array</span></dt>
      <dd>
         <code>msg.subscription</code> should contain the topic, an array of topics, an object conatining topic and properties or an array of objects conatining topic and properties<br>
         * This property is only valid when <code>action</code> is "subscribe" or "unsubscribe"</code>
         <h5>example 1...</h5>
         <pre style="font-size: smaller;white-space: pre;">msg.subscription = "topic/subtopic1"</pre> 
         <h5>example 2...</h5>
         <pre style="font-size: smaller;white-space: pre;">msg.subscription = ["topic/subtopic1", "topic/subtopic2"];</pre>  
         <h5>example 3...</h5>
         <pre style="font-size: smaller;white-space: pre;">msg.subscription = [
   {
      "topic": "topic/subtopic1", 
      "qos": 2, //(optional) 0: fire and forget, 1: at least once, 2: once and once only
      "retain": false, //(optional) true indicates the message was retained and may be old
      "nl": false, //(optional) No local - Do not receive messages published by this client
      "rap": false, //(optional) Retain publish - Keep retain flag of original publish
      "rh": 1, //(optional) Retain Handling - 0: Send retained messages, 1: Only send for new subscriptions, 2: Do not send
   }
];</pre> 
      </dd>

      <hr style="margin: 8px">

      <h4 style="font-size: medium;font-style: italic;">"publish" action message properties...</h4>
      <dt>payload <span class="property-type">string | buffer</span></dt>
      <dd>the payload to publish. If this property is not set, no message will be sent. To send a blank message, set this property to an empty String.</dd>
      <dt>topic <span class="property-type">string</span></dt>
      <dd>the MQTT topic, uses / as a hierarchy separator. Only used for action "publish"</dd>
      <dt class="optional">qos <span class="property-type">number</span> </dt>
      <dd>0, fire and forget - 1, at least once - 2, once and once only.</dd>
      <dt class="optional">retain <span class="property-type">boolean</span></dt>
      <dd>true indicates the message was retained and may be old.</dd>
      <dt class="optional">responseTopic <span class="property-type">string</span></dt>
      <dd><b>MQTTv5</b>: the MQTT response topic for the message</dd>
      <dt class="optional">correlationData <span class="property-type">Buffer</span></dt>
      <dd><b>MQTTv5</b>: the correlation data for the message</dd>
      <dt class="optional">contentType <span class="property-type">string</span></dt>
      <dd><b>MQTTv5</b>: the content-type of the payload</dd>
      <dt class="optional">userProperties <span class="property-type">object</span></dt>
      <dd><b>MQTTv5</b>: any user properties of the message</dd>
      <dt class="optional">messageExpiryInterval <span class="property-type">number</span></dt>
      <dd><b>MQTTv5</b>: the expiry time, in seconds, of the message</dd>

      <hr style="margin: 8px">

      <h4 style="font-size: medium;font-style: italic;">"list" action message properties...</h4>
      <dd>The "list" action requires no additional properties</dd>

   </dl>

   <h3>Output 1</h3>
   <dl class="message-properties">
      <h4>messages from the subscribed topics. Each msg will contains... </h4>
      <dt>payload <span class="property-type">string | buffer | object</span></dt>
      <dd>the MQTT payload recieved from broker.</dd>
      <dt>topic <span class="property-type">string</span></dt>
      <dd>the MQTT topic, uses / as a hierarchy separator.</dd>
      <dt>qos <span class="property-type">number</span> </dt>
      <dd>0, fire and forget - 1, at least once - 2, once and once only.</dd>
      <dt>retain <span class="property-type">boolean</span></dt>
      <dd>true indicates the message was retained and may be old.</dd>

      <dt class="optional">responseTopic <span class="property-type">string</span></dt>
      <dd><b>MQTTv5</b>: the MQTT response topic for the message</dd>
      <dt class="optional">correlationData <span class="property-type">Buffer</span></dt>
      <dd><b>MQTTv5</b>: the correlation data for the message</dd>
      <dt class="optional">contentType <span class="property-type">string</span></dt>
      <dd><b>MQTTv5</b>: the content-type of the payload</dd>
      <dt class="optional">userProperties <span class="property-type">object</span></dt>
      <dd><b>MQTTv5</b>: any user properties of the message</dd>
      <dt class="optional">messageExpiryInterval <span class="property-type">number</span></dt>
      <dd><b>MQTTv5</b>: the expiry time, in seconds, of the message</dd>
   </dl>
   
   <h3>Output 2</h3>
   <dl class="message-properties">
      <h4 style="font-size: medium;font-style: italic;">messages in response to an action</h4>
      <h5>"subscribe", "unsubscribe" and "list" action messages will contain...</h5>
      <dt>payload <span class="property-type">array</span></dt>
      <dd>an array containing the dynamic subscriptions this node will respond to.</dd>
      <hr style="margin: 8px">
      <h5>"connect" and "disconnect" action messages will return...</h5>
      <dd>the original msg</dd>
   </dl>   
   <h3>Details</h3>
   <p>A subscription topic can include MQTT wildcards, + for one level, # for multiple levels.</p>
   <p>This node requires a connection to a MQTT broker to be configured. This is configured by clicking
   the pencil icon.</p>
   <p>To make a dynamic connection, you can turn off the broker option "auto connect" then run the "connect" action with a new broker connection url.</p>
   <p>Several MQTT nodes (in or out) can share the same broker connection if required.</p>
</script>

<script type="text/html" data-help-name="mqtt out">
    <p>Connects to a MQTT broker and publishes messages.</p>
    <h3>Inputs</h3>
    <dl class="message-properties">
       <dt>payload <span class="property-type">string | buffer</span></dt>
       <dd> the payload to publish. If this property is not set, no message will be sent. To send a blank message, set this property to an empty String.</dd>
       <dt class="optional">topic <span class="property-type">string</span></dt>
       <dd> the MQTT topic to publish to.</dd>
       <dt class="optional">qos <span class="property-type">number</span></dt>
       <dd>0, fire and forget - 1, at least once - 2, once and once only. Default 0.</dd>
       <dt class="optional">retain <span class="property-type">boolean</span></dt>
       <dd>set to true to retain the message on the broker. Default false.</dd>
       <dt class="optional">responseTopic <span class="property-type">string</span></dt>
       <dd><b>MQTTv5</b>: the MQTT response topic for the message</dd>
       <dt class="optional">correlationData <span class="property-type">Buffer</span></dt>
       <dd><b>MQTTv5</b>: the correlation data for the message</dd>
       <dt class="optional">contentType <span class="property-type">string</span></dt>
       <dd><b>MQTTv5</b>: the content-type of the payload</dd>
       <dt class="optional">userProperties <span class="property-type">object</span></dt>
       <dd><b>MQTTv5</b>: any user properties of the message</dd>
       <dt class="optional">messageExpiryInterval <span class="property-type">number</span></dt>
       <dd><b>MQTTv5</b>: the expiry time, in seconds, of the message</dd>
       <dt class="optional">topicAlias <span class="property-type">number</span></dt>
       <dd><b>MQTTv5</b>: the MQTT topic alias to use</dd>
    </dl>
    <h3>Details</h3>
    <code>msg.payload</code> is used as the payload of the published message.
    If it contains an Object it will be converted to a JSON string before being sent.
    If it contains a binary Buffer the message will be published as-is.</p>
    <p>The topic used can be configured in the node or, if left blank, can be set by <code>msg.topic</code>.</p>
    <p>Likewise the QoS and retain values can be configured in the node or, if left
    blank, set by <code>msg.qos</code> and <code>msg.retain</code> respectively. To clear a previously
    retained topic from the broker, send a blank message to that topic with the retain flag set.</p>
    <p>This node requires a connection to a MQTT broker to be configured. This is configured by clicking
    the pencil icon.</p>
    <p>Several MQTT nodes (in or out) can share the same broker connection if required.</p>
</script>

<script type="text/html" data-help-name="mqtt-broker">
    <p>Configuration for a connection to an MQTT broker.</p>
    <p>This configuration will create a single connection to the broker which can
       then be reused by <code>MQTT In</code> and <code>MQTT Out</code> nodes.</p>
    <p>The node will generate a random Client ID if one is not set and the
       node is configured to use a Clean Session connection. If a Client ID is set,
       it must be unique to the broker you are connecting to.</p>
    <h4>Birth Message</h4>
    <p>This is a message that will be published on the configured topic whenever the
       connection is established.</p>
    <h4>Close Message</h4>
    <p>This is a message that will be published on the configured topic before the
       connection is closed normally, either by re-deploying the node, or by shutting down.</p>
    <h4>Will Message</h4>
    <p>This is a message that will be published by the broker in the event the node
       unexpectedly loses its connection.</p>
    <h4>WebSockets</h4>
    <p>The node can be configured to use a WebSocket connection. To do so, the Server
       field should be configured with a full URI for the connection. For example:</p>
    <pre>ws://example.com:4000/mqtt</pre>

</script>
